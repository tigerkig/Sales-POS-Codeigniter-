function checkbox_click(e){do_email(enable_email.url),$(e.target).prop("checked")?$(e.target).parent().parent().find("td").addClass("selected").css("backgroundColor",""):$(e.target).parent().parent().find("td").removeClass("selected"),determine_checkbox_status()}function enable_search(e,a){enable_search.enabled||(enable_search.enabled=!0),$("#search").focus(),$("#search").click(function(){$(this).attr("value","")}),$("#search").autocomplete({source:e+"/suggest",delay:150,autoFocus:!1,minLength:0,select:function(a,t){ENABLE_QUICK_EDIT?window.location.href=e+"/view/"+t.item.value+"/2":(a.preventDefault(),$(this).val(t.item.label),do_search(!0))}}).data("ui-autocomplete")._renderItem=function(a,t){return $("<li class='customer-badge suggestions'></li>").data("item.autocomplete",t).append('<a href="'+e+"/view/"+t.value+'/2"  class="suggest-item"><div class="avatar"><img src="'+t.avatar+'" alt=""></div><div class="details"><div class="name">'+t.label+'</div><span class="email">'+t.subtitle+"</span></div></a>").appendTo(a)},$("#search").bind("keypress",function(e){13==e.keyCode&&(e.preventDefault(),$("#search").autocomplete("close"),$("#search").val($(this).val()),$("#search_form").submit())}),$("#search_form").submit(function(e){e.preventDefault(),get_selected_values().length>0?bootbox.confirm(a,function(e){e&&do_search(!0)}):do_search(!0)})}function do_search(e,a){enable_search.enabled&&(e&&$("#spinner").show(),$("#ajax-loader").show(),$("#search_form").ajaxSubmit({success:function(e){"function"==typeof a&&a(),$("#sortable_table tbody").html(e.manage_table),$("#manage_total_items").html(e.total_rows),$(".clear-block").removeClass("hidden"),""==e.pagination?$(".pagination").addClass("hidden"):($(".pagination").removeClass("hidden"),$(".pagination").html(e.pagination)),$("#spinner").hide(),$("#ajax-loader").hide(),update_sortable_table(),enable_row_selection(),$("#sortable_table tbody :checkbox").click(checkbox_click),$("#select_all").attr("checked",!1)},dataType:"json"}))}function enable_email(e){enable_email.enabled||(enable_email.enabled=!0),enable_email.url||(enable_email.url=e),$("#select_all, #sortable_table tbody :checkbox").click(checkbox_click)}function do_email(e){enable_email.enabled&&$.post(e,{"ids[]":get_selected_values()},function(e){$("#email").attr("href",e)})}function enable_checkboxes(){$("#select_all, #sortable_table tbody :checkbox").click(checkbox_click)}function enable_delete(e,a){enable_delete.enabled||(enable_delete.enabled=!0),$("#delete").click(function(a){a.preventDefault(),$("#sortable_table tbody :checkbox:checked").length>0&&bootbox.confirm(e,function(e){e&&do_delete($("#delete").attr("href"))})})}function do_delete(e){if(enable_delete.enabled){var a=get_selected_values(),t=get_selected_rows();$.post(e,{"ids[]":a},function(e){e.success?(show_feedback("success",e.message,COMMON_SUCCESS),$(".manage-row-options").addClass("hidden"),$(t).each(function(e,a){$(this).find("td").addClass({backgroundColor:"#FF0000"},1200,"linear").end().animate({opacity:0},1200,"linear",function(){$(this).remove(),update_sortable_table()})})):show_feedback("error",e.message,COMMON_ERROR)},"json")}}function enable_select_all(){enable_select_all.enabled||(enable_select_all.enabled=!0),$("#select_all").click(function(){$(this).prop("checked")?($("#selectall").show("medium"),$("#sortable_table tbody :checkbox").each(function(){$(this).prop("checked",!0),$(this).parent().parent().find("td").addClass("selected").css("backgroundColor","")})):($("#selectall").hide("medium"),$("#selectnone").hide("medium"),$("#sortable_table tbody :checkbox").each(function(){$(this).prop("checked",!1),$(this).parent().parent().find("td").removeClass("selected")}))})}function enable_row_selection(e){enable_row_selection.enabled||(enable_row_selection.enabled=!0),"undefined"==typeof e&&(e=$("#sortable_table tbody tr")),e.hover(function a(){$(this).css("cursor","pointer")},function t(){$(this).find("td").hasClass("selected")||$(this).find("td").removeClass("over")}),e.click(function l(e){var a=$(this).find(":checkbox");a.prop("checked",!a.prop("checked")),do_email(enable_email.url),a.prop("checked")?$(this).find("td").addClass("selected").css("backgroundColor",""):$(this).find("td").removeClass("selected").css("backgroundColor",""),determine_checkbox_status()})}function update_sortable_table(){if($("#sortable_table").trigger("update"),"undefined"!=typeof $("#sortable_table")[0].config){var e=$("#sortable_table")[0].config.sortList;$("#sortable_table").trigger("sorton",[e])}}function update_row(e,a){$.post(a,{row_id:e},function(a){var t=$("#sortable_table tbody tr :checkbox[value="+e+"]").parent().parent();t.replaceWith(a),reinit_row(e),highlight_row(e)})}function reinit_row(e){var a=$("#sortable_table tbody tr :checkbox[value="+e+"]"),t=a.parent().parent();enable_row_selection(t),update_sortable_table(),a.click(checkbox_click)}function highlight_row(e){var a=$("#sortable_table tbody tr :checkbox[value="+e+"]"),t=a.parent().parent();t.find("td").animate({backgroundColor:"#e1ffdd"},"slow","linear").animate({backgroundColor:"#e1ffdd"},5e3).animate({backgroundColor:"#e9e9e9"},"slow","linear")}function get_selected_values(){var e=new Array;return $("#sortable_table tbody :checkbox:checked").each(function(){e.push($(this).val())}),e}function get_selected_rows(){var e=new Array;return $("#sortable_table tbody :checkbox:checked").each(function(){e.push($(this).parent().parent())}),e}function get_visible_checkbox_ids(){var e=new Array;return $("#sortable_table tbody :checkbox").each(function(){e.push($(this).val())}),e}function determine_checkbox_status(){$("#sortable_table tbody :checkbox:checked").length>0?($(".manage-row-options").removeClass("hidden"),$("#email").removeClass("disabled"),$("#delete").removeClass("disabled"),$("#generate_barcodes").removeClass("disabled"),$("#generate_barcode_labels").removeClass("disabled"),$("#bulk_edit").removeClass("disabled")):($(".manage-row-options").addClass("hidden"),$("#email").addClass("disabled"),$("#delete").addClass("disabled"),$("#generate_barcodes").addClass("disabled"),$("#generate_barcode_labels").addClass("disabled"),$("#bulk_edit").addClass("disabled"))}function enable_cleanup(e){enable_cleanup.enabled||(enable_cleanup.enabled=!0),$("#cleanup").click(function(a){do_cleanup(a,e)})}function do_cleanup(e,a){e.preventDefault(),enable_cleanup.enabled&&bootbox.confirm(a,function(e){e&&$.post($("#cleanup").attr("href"),{},function(e){show_feedback("success",e.message,COMMON_SUCCESS)},"json")})}function enable_sorting(e,a,t,l,n){enable_sorting.enabled||(enable_sorting.enabled=!0);var o=0;$("#pagination_top").find("strong").text()>0&&(o=($("#pagination_top").find("strong").text()-1)*t);var s=a.indexOf(l);"asc"==n?($("#sortable_table tr th").removeClass("header headerSortUp").removeClass("header headerSortDown"),$("#sortable_table tr th").eq(s).addClass("header headerSortUp")):($("#sortable_table tr th").removeClass("header headerSortUp").removeClass("header headerSortDown"),$("#sortable_table tr th").eq(s).addClass("header headerSortDown")),$("#sortable_table tr th").click(function(){a[$(this).parent().children().index($(this))]&&($("#sortable_table tbody").html('<img src="assets/img/ajax-loader.gif"  width="16" height="16" />'),$(this).hasClass("headerSortUp")?(do_sorting(e,0,a[$(this).parent().children().index($(this))],"desc"),$("#sortable_table tr th").removeClass("header headerSortUp").removeClass("header headerSortDown"),$(this).removeClass("header headerSortUp").addClass("header headerSortDown")):(do_sorting(e,0,a[$(this).parent().children().index($(this))],"asc"),$("#sortable_table tr th").removeClass("header headerSortUp").removeClass("header headerSortDown"),$(this).removeClass("header headerSortUp").addClass("header headerSortUp")))}),$(document).on("click",".pagination a",function(e){e.preventDefault(),$(".manage-row-options").addClass("hidden");var t=is_int($(this).attr("href").substring($(this).attr("href").lastIndexOf("/")+1))?$(this).attr("href").substring($(this).attr("href").lastIndexOf("/")+1):0,l=$("#sortable_table tr th.header").parent().children().index($("#sortable_table tr th.header")),n=1==$("#sortable_table tr th.headerSortDown").length?"desc":"asc";do_sorting($(this).attr("href"),t,l>=0?a[l]:0,n)})}function do_sorting(e,a,t,l){var n={search:$("#search").val(),offset:a,order_col:t,order_dir:l};1==$("#category_id").length&&(n.category_id=$("#category_id").val()),1==$("#fields").length&&(n.fields=$("#fields").val()),$.post(e,n,function(e){$("#sortable_table tbody").html(e.manage_table),$(".pagination").html(e.pagination),update_sortable_table(),enable_row_selection(),$("#sortable_table tbody :checkbox").click(checkbox_click),$("#select_all").prop("checked",!1)},"json")}enable_search.enabled=!1,enable_email.enabled=!1,enable_email.url=!1,enable_delete.enabled=!1,enable_select_all.enabled=!1,enable_row_selection.enabled=!1,enable_cleanup.enabled=!1,enable_sorting.enabled=!1,$(document).on("click",".btn-clear-selection",function(e){e.preventDefault(),$("#sortable_table tbody :checkbox").each(function(){$(this).prop("checked",!1),$(this).parent().parent().find("td").removeClass("selected")}),$(".manage-row-options").addClass("hidden")});